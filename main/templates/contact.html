{% load static %}
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <title>Thống Kê Giao Thông - Hệ Thống Giám Sát</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <link href="{% static 'img/favicon.ico' %}" rel="icon" />

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&display=swap" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />

    <!-- CSS -->
    <link href="{% static 'lib/animate/animate.min.css' %}" rel="stylesheet" />
    <link href="{% static 'lib/owlcarousel/assets/owl.carousel.min.css' %}" rel="stylesheet" />
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
    <link href="{% static 'css/style.css' %}" rel="stylesheet" />

    <style>
        :root {
            --gradient-blue: linear-gradient(135deg, #00ADEF 0%, #007bff 100%);
            --gradient-purple: linear-gradient(135deg, #00ADEF 0%, #0D6EFD 100%);
            --gradient-orange: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-green: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }

        .stats-header {
            background: linear-gradient(135deg, rgba(0, 173, 239, 0.95) 0%, rgba(0, 123, 255, 0.95) 100%),
            url('{% static "img/anhnenmetro.jpg" %}') center center no-repeat;
            background-size: cover;
            padding: 100px 0 60px;
            position: relative;
            overflow: hidden;
        }

        .stats-header::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 60%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .filter-section {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            margin-bottom: 50px;
            position: relative;
            overflow: hidden;
        }

        .filter-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: var(--gradient-blue);
        }

        .modern-input {
            border-radius: 15px;
            border: 2px solid #e8e8e8;
            padding: 14px 20px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .modern-input:focus {
            border-color: #00ADEF;
            box-shadow: 0 0 0 4px rgba(0, 173, 239, 0.1);
            background: white;
        }

        .btn-search {
            background: var(--gradient-blue);
            border: none;
            border-radius: 15px;
            padding: 14px 35px;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(79, 172, 254, 0.3);
        }

        .btn-search:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(79, 172, 254, 0.4);
            color: white;
        }

        .metric-card {
            background: white;
            border-radius: 25px;
            padding: 35px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            height: 100%;
        }

        .metric-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(79, 172, 254, 0.1) 0%, transparent 70%);
            transform: translate(50%, 50%);
        }

        .metric-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }

        .metric-card.blue {
            border-top: 5px solid #00ADEF;
        }

        .metric-card.purple {
            border-top: 5px solid #00ADEF;
        }

        .metric-card.orange {
            border-top: 5px solid #fa709a;
        }

        .metric-icon-box {
            width: 90px;
            height: 90px;
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            position: relative;
            z-index: 1;
        }

        .metric-card.blue .metric-icon-box {
            background: var(--gradient-blue);
        }

        .metric-card.purple .metric-icon-box {
            background: var(--gradient-purple);
        }

        .metric-card.orange .metric-icon-box {
            background: var(--gradient-orange);
        }

        .metric-value {
            font-size: 3.5rem;
            font-weight: 700;
            margin: 20px 0 10px;
            position: relative;
            z-index: 1;
        }

        .metric-card.blue .metric-value {
            background: var(--gradient-blue);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-card.purple .metric-value {
            background: var(--gradient-purple);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-card.orange .metric-value {
            background: var(--gradient-orange);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-label {
            font-size: 1.2rem;
            color: #666;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .chart-card {
            background: white;
            border-radius: 25px;
            padding: 45px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #333;
        }

        .chart-subtitle {
            color: #999;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .trend-up {
            background: linear-gradient(135deg, rgba(86, 171, 47, 0.15) 0%, rgba(168, 224, 99, 0.15) 100%);
            color: #56ab2f;
        }

        .trend-down {
            background: linear-gradient(135deg, rgba(245, 87, 108, 0.15) 0%, rgba(240, 147, 251, 0.15) 100%);
            color: #f5576c;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-scale {
            animation: fadeInScale 0.6s ease-out;
        }
    </style>
</head>

<body>
    <div class="container-xxl bg-white p-0">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg bg-white navbar-light shadow sticky-top p-0">
            <a href="index.html" class="navbar-brand d-flex align-items-center text-center py-0 px-4 px-lg-5">
                <h1 class="m-0 text-primary"><i class="bi bi-camera-video me-2"></i>TrafficVision</h1>
            </a>
            <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse"
                data-bs-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav ms-auto p-4 p-lg-0">
                    <a href="index.html" class="nav-item nav-link">Trang chủ</a>
                    <a href="about.html" class="nav-item nav-link">Giám sát trực tuyến</a>
                    <a href="job-list.html" class="nav-item nav-link">Đo tốc độ phương tiện</a>
                    <a href="category.html" class="nav-item nav-link">Báo Cáo</a>
                    <a href="contact.html" class="nav-item nav-link active">Thống kê giao thông</a>
                </div>
                <a href="job-detail.html" class="btn btn-primary rounded-0 py-4 px-lg-5 d-none d-lg-block">
                    Bản Đồ Camera<i class="fa fa-arrow-right ms-3"></i>
                </a>
            </div>
        </nav>

        <!-- Header -->
        <div class="stats-header">
            <div class="container my-5 pt-5 pb-4 position-relative" style="z-index: 1;">
                <h1 class="display-3 text-white mb-3 animated slideInDown fw-bold">
                    <i class="fas fa-chart-area me-3"></i>Thống Kê Giao Thông
                </h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb text-uppercase">
                        <li class="breadcrumb-item"><a href="index.html" class="text-white-50">Trang chủ</a></li>
                        <li class="breadcrumb-item text-white active" aria-current="page">Thống kê</li>
                    </ol>
                </nav>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="container-xxl py-5">
            <div class="container">
                <div class="text-center mb-5">
                    <h2 class="display-6 fw-bold mb-3">Phân Tích Dữ Liệu Giao Thông Chi Tiết</h2>
                    <p class="text-muted fs-5">Cập nhật liên tục 24/7 với độ chính xác cao</p>
                </div>

                <!-- Bộ lọc -->
                <form class="filter-section animate-scale" method="GET" action="">
                    <div class="row g-4">
                        <div class="col-md-3">
                            <label for="start_date" class="form-label fw-bold">
                                <i class="fas fa-calendar-alt me-2 text-primary"></i>Từ ngày
                            </label>
                            <input type="date" class="form-control modern-input" id="start_date" name="start_date"
                                value="{{ request.GET.start_date }}">
                        </div>
                        <div class="col-md-3">
                            <label for="end_date" class="form-label fw-bold">
                                <i class="fas fa-calendar-check me-2 text-primary"></i>Đến ngày
                            </label>
                            <input type="date" class="form-control modern-input" id="end_date" name="end_date"
                                value="{{ request.GET.end_date }}">
                        </div>
                        <div class="col-md-3">
                            <label for="location" class="form-label fw-bold">
                                <i class="fas fa-map-marker-alt me-2 text-primary"></i>Khu vực
                            </label>
                            <select class="form-select modern-input" id="location" name="location">
                                <option value="" {% if not request.GET.location %}selected{% endif %}>Tất cả</option>
                                <option value="Quận 1" {% if request.GET.location == "Quận 1" %}selected{% endif %}>Quận 1
                                </option>
                                <option value="Quận 3" {% if request.GET.location == "Quận 3" %}selected{% endif %}>Quận 3
                                </option>
                                <option value="Quận 5">Quận 5</option>
                                <option value="Quận 7">Quận 7</option>
                                <option value="Quận 10">Quận 10</option>
                                <option value="Thủ Đức">Thủ Đức</option>
                                <option value="Bình Thạnh">Bình Thạnh</option>
                                <option value="Tân Bình">Tân Bình</option>
                                <option value="Phú Nhận">Phú Nhuận</option>
                            </select>
                        </div>
                        <div class="col-md-3 d-flex align-items-end">
                            <button type="submit" class="btn btn-search w-100">
                                <i class="fas fa-search me-2"></i>Tìm Kiếm
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Kết quả -->
                <div class="row g-4 mb-5">
                    <div class="col-lg-4 col-md-6 animate-scale" style="animation-delay: 0.1s;">
                        <div class="metric-card blue">
                            <div class="metric-icon-box">
                                <i class="fas fa-car fa-3x text-white"></i>
                            </div>
                            <div class="text-center">
                                <div class="metric-value">{{ total_vehicles|default:"12,435" }}</div>
                                <div class="metric-label">Số Lượng Phương Tiện</div>
                                <span class="trend-indicator trend-up">
                                    <i class="fas fa-arrow-up me-2"></i>+12% so với tuần trước
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6 animate-scale" style="animation-delay: 0.2s;">
                        <div class="metric-card purple">
                            <div class="metric-icon-box">
                                <i class="fas fa-tachometer-alt fa-3x text-white"></i>
                            </div>
                            <div class="text-center">
                                <div class="metric-value">{{ avg_speed|default:"43.7" }} <span
                                        style="font-size: 1.5rem;">km/h</span></div>
                                <div class="metric-label">Vận Tốc Trung Bình</div>
                                <span class="trend-indicator trend-down">
                                    <i class="fas fa-arrow-down me-2"></i>-3% so với tuần trước
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6 animate-scale" style="animation-delay: 0.3s;">
                        <div class="metric-card orange">
                            <div class="metric-icon-box">
                                <i class="fas fa-clock fa-3x text-white"></i>
                            </div>
                            <div class="text-center">
                                <div class="metric-value" style="font-size: 2.2rem;">{{ peak_time|default:"07:00 - 08:30" }}</div>
                                <div class="metric-label">Thời Điểm Cao Điểm</div>
                                <span class="trend-indicator trend-up">
                                    <i class="fas fa-info-circle me-2"></i>Ổn định
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Biểu đồ chính -->
                <div class="chart-card animate-scale" style="animation-delay: 0.4s;">
                    <div class="chart-title">
                        <i class="fas fa-chart-line text-primary me-2"></i>Lưu Lượng Phương Tiện Theo Giờ
                    </div>
                    <p class="chart-subtitle">Phân tích xu hướng giao thông trong 24 giờ</p>
                    <canvas id="trafficChart" style="max-height: 400px;"></canvas>
                </div>

                <!-- Biểu đồ phụ -->
                <div class="row g-4">
                    <div class="col-lg-6 animate-scale" style="animation-delay: 0.5s;">
                        <div class="chart-card">
                            <div class="chart-title">
                                <i class="fas fa-chart-pie text-primary me-2"></i>Phân Loại Theo Loại Xe
                            </div>
                            <p class="chart-subtitle">Tỷ lệ phần trăm từng loại phương tiện</p>
                            <canvas id="vehicleDistribution" style="max-height: 350px;"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-6 animate-scale" style="animation-delay: 0.6s;">
                        <div class="chart-card">
                            <div class="chart-title">
                                <i class="fas fa-chart-bar text-primary me-2"></i>So Sánh Theo Ngày
                            </div>
                            <p class="chart-subtitle">Lưu lượng 7 ngày gần nhất</p>
                            <canvas id="weeklyComparison" style="max-height: 350px;"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Thống kê bổ sung -->
                <div class="row g-4 mt-4">
                    <div class="col-md-3">
                        <div class="text-center p-4"
                            style="background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%); border-radius: 20px;">
                            <i class="fas fa-users fa-3x mb-3" style="color: #4facfe;"></i>
                            <h4 class="fw-bold">50+</h4>
                            <p class="text-muted mb-0">Camera Hoạt Động</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-4"
                            style="background: linear-gradient(135deg, rgba(0, 173, 239, 0.1) 0%, rgba(13, 110, 253, 0.1) 100%); border-radius: 20px;">
                            <i class="fas fa-map-marked-alt fa-3x mb-3" style="color: #00ADEF;"></i>
                            <h4 class="fw-bold">15</h4>
                            <p class="text-muted mb-0">Khu Vực Giám Sát</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-4"
                            style="background: linear-gradient(135deg, rgba(250, 112, 154, 0.1) 0%, rgba(254, 225, 64, 0.1) 100%); border-radius: 20px;">
                            <i class="fas fa-database fa-3x mb-3" style="color: #fa709a;"></i>
                            <h4 class="fw-bold">98%</h4>
                            <p class="text-muted mb-0">Độ Chính Xác</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-4"
                            style="background: linear-gradient(135deg, rgba(48, 207, 208, 0.1) 0%, rgba(51, 8, 103, 0.1) 100%); border-radius: 20px;">
                            <i class="fas fa-clock fa-3x mb-3" style="color: #30cfd0;"></i>
                            <h4 class="fw-bold">24/7</h4>
                            <p class="text-muted mb-0">Hoạt Động</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="container-fluid bg-dark text-white-50 footer pt-5 mt-5">
            <div class="container py-5">
                <div class="row g-5">
                    <div class="col-lg-4">
                        <h5 class="text-white mb-4"><i class="bi bi-camera-video me-2"></i>TrafficVision</h5>
                        <p>Hệ thống theo dõi và thống kê phương tiện giao thông theo thời gian thực.</p>
                    </div>
                    <div class="col-lg-4">
                        <h5 class="text-white mb-4">Liên Hệ</h5>
                        <p><i class="fa fa-map-marker-alt me-3"></i>TP. Hồ Chí Minh, Việt Nam</p>
                        <p><i class="fa fa-envelope me-3"></i>support@trafficvision.vn</p>
                        <p><i class="fa fa-phone-alt me-3"></i>+84 123 456 789</p>
                    </div>
                    <div class="col-lg-4">
                        <h5 class="text-white mb-4">Kết Nối</h5>
                        <div class="d-flex">
                            <a class="btn btn-outline-light btn-social me-2" href="#"><i
                                    class="fab fa-facebook-f"></i></a>
                            <a class="btn btn-outline-light btn-social me-2" href="#"><i class="fab fa-youtube"></i></a>
                            <a class="btn btn-outline-light btn-social" href="#"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="copyright">
                    <div class="row">
                        <div class="col-md-12 text-center py-3">
                            &copy; 2024 <a class="border-bottom text-white" href="#">TrafficVision</a>. Bảo lưu mọi
                            quyền.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'lib/wow/wow.min.js' %}"></script>
    <script src="{% static 'lib/easing/easing.min.js' %}"></script>
    <script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
    <script src="{% static 'lib/owlcarousel/owl.carousel.min.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        new WOW().init();

        // Traffic Chart
        const ctx = document.getElementById('trafficChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(0, 173, 239, 0.8)');
        gradient.addColorStop(1, 'rgba(0, 173, 239, 0.2)');

        const trafficChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['0:00', '2:00', '4:00', '6:00', '8:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'],
                datasets: [{
                    label: 'Số lượng phương tiện',
                    data: [80, 45, 30, 120, 320, 280, 210, 180, 240, 350, 280, 150],
                    backgroundColor: gradient,
                    borderColor: '#00ADEF',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 5,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#00ADEF',
                    pointBorderWidth: 2,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(0, 0, 0, 0.05)' }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });

        // Vehicle Distribution
        const vehicleCtx = document.getElementById('vehicleDistribution').getContext('2d');
        const vehicleChart = new Chart(vehicleCtx, {
            type: 'doughnut',
            data: {
                labels: ['Xe con', 'Xe máy', 'Xe tải', 'Xe buýt'],
                datasets: [{
                    data: [45, 35, 15, 5],
                    backgroundColor: [
                        '#00ADEF',
                        '#00ADEF',
                        '#fa709a',
                        '#fee140'
                    ],
                    borderWidth: 4,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            font: { size: 13 }
                        }
                    }
                }
            }
        });

        // Weekly Comparison
        const weeklyCtx = document.getElementById('weeklyComparison').getContext('2d');
        const weeklyChart = new Chart(weeklyCtx, {
            type: 'bar',
            data: {
                labels: ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'],
                datasets: [{
                    label: 'Lưu lượng xe',
                    data: [2800, 3200, 3100, 3400, 3600, 2900, 2200],
                    backgroundColor: [
                        'rgba(0, 173, 239, 0.8)',
                        'rgba(0, 173, 239, 0.8)',
                        'rgba(250, 112, 154, 0.8)',
                        'rgba(254, 225, 64, 0.8)',
                        'rgba(48, 207, 208, 0.8)',
                        'rgba(0, 173, 239, 0.8)',
                        'rgba(0, 173, 239, 0.8)'
                    ],
                    borderRadius: 10,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(0, 0, 0, 0.05)' }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });
    </script>
</body>

</html>